<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vay tiêu dùng tín chấp | Shinhan Bank</title>
    <meta name="description" content="Vay tiêu dùng, vay mua nhà, vay mua xe với lãi suất từ 1.9%/năm, hạn mức đến 600 triệu đồng. Đăng ký online nhanh chóng.">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Vay tiêu dùng tín chấp | Shinhan Bank">
    <meta property="og:description" content="Vay tiêu dùng, vay mua nhà, vay mua xe với lãi suất từ 1.9%/năm, hạn mức đến 600 triệu đồng. Đăng ký online nhanh chóng.">
    <meta property="og:image" content="https://example.com/logo.png">
    <meta property="og:type" content="article">

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="public/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="public/favicon-180x180.png">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React CDN -->
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <!-- Chart.js for Payment Chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Compressor.js for Image Compression -->
    <script src="https://cdn.jsdelivr.net/npm/compressorjs@1.2.1/dist/compressor.min.js"></script>
    <!-- EmailJS for Sending Emails -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4.0.3/dist/email.min.js"></script>
    <!-- html2pdf.js for PDF Download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <!-- Font Awesome for Icons -->
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <!-- Google Maps API -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY"></script>
    <!-- FaceIO for Face Verification -->
    <script src="https://cdn.face.io/faceio.js"></script>

    <style>
        body {
            font-family: 'Roboto', Arial, sans-serif;
            background: #f5f8fa;
            color: #000;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: #004b8d;
            color: #fff;
            padding: 20px;
            text-align: center;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .section h2 {
            color: #004b8d;
        }
        .section p {
            line-height: 1.6;
        }
        .btn-primary {
            background: #f28c38;
            color: #fff;
            padding: 12px 32px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: background 0.3s ease;
        }
        .btn-primary:hover {
            background: #d97a30;
        }
        .modal-content {
            border-radius: 10px;
            padding: 20px;
            background: #fff;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 100%;
            margin: 20px auto;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }
        .modal-content-lg {
            max-width: 1200px;
        }
        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #004b8d;
            text-align: center;
            text-transform: uppercase;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        /* Loan Calculator Styles */
        #loanForm {
            background-color: #e6f0fa;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        #loanForm label {
            display: block;
            margin: 10px 0 5px;
            color: #004b8d;
        }
        #loanForm input, #loanForm select {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }
        #loanForm button {
            width: 100%;
            padding: 12px;
            background-color: #f28c38;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        #loanForm button:hover {
            background-color: #d97a30;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: white;
        }
        #result table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        #result th, #result td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: right;
        }
        #result th {
            background-color: #004b8d;
            color: white;
        }
        #result td {
            background-color: #f9f9f9;
        }
        .suggestion {
            margin-top: 20px;
            padding: 10px;
            background-color: #e6f0fa;
            border-radius: 4px;
        }
        .suggestion h4 {
            color: #004b8d;
            margin-bottom: 10px;
        }
        .suggestion ul {
            margin: 0;
            padding-left: 20px;
        }
        /* Registration Form Styles */
        .progress-bar {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }
        .progress-step {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: #f4f4f4;
            border-radius: 5px;
            font-size: 14px;
            color: #333;
            transition: all 0.3s ease;
        }
        .progress-step.active {
            background: #004b8d;
            color: #fff;
        }
        .input-container {
            margin-bottom: 15px;
            position: relative;
        }
        .input-container input, .input-container select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        .input-container input:focus, .input-container select:focus {
            border-color: #004b8d;
            outline: none;
        }
        .input-container .error {
            border-color: #EF4444;
        }
        .input-container .error-message {
            color: #EF4444;
            font-size: 12px;
            margin-top: 4px;
        }
        .tooltip {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #004b8d;
            color: #fff;
            padding: 5px;
            border-radius: 5px;
            font-size: 12px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }
        .input-container:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }
        .photo-preview {
            width: 100%;
            max-width: 300px;
            height: 200px;
            object-fit: cover;
            border-radius: 5px;
            border: 1px solid #ddd;
            margin-top: 10px;
            transition: transform 0.2s ease;
        }
        .photo-preview:hover {
            transform: scale(1.05);
        }
        .face-scan-circle {
            width: 200px;
            height: 200px;
            border: 3px dashed #004b8d;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            background: rgba(0, 75, 141, 0.1);
            font-size: 16px;
            color: #004b8d;
        }
        .contract-container, .disbursement-container {
            background: #fff;
            padding: 20px;
            border: 2px solid #004b8d;
            border-radius: 10px;
            position: relative;
            margin-bottom: 20px;
            color: #000;
        }
        .contract-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border: 1px solid #004b8d;
        }
        .contract-table th, .contract-table td {
            border: 1px solid #004b8d;
            padding: 8px;
            text-align: left;
            font-size: 14px;
        }
        .contract-table th {
            background: #004b8d;
            color: #fff;
            font-weight: 700;
        }
        .contract-footer {
            text-align: center;
            font-size: 12px;
            background: #e6f0fa;
            color: #000;
            padding: 10px;
            margin-top: 20px;
        }
        .red-stamp {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 100px;
            height: 100px;
            background: url('https://example.com/shinhan-life-stamp.png') no-repeat center;
            background-size: contain;
            opacity: 0.8;
        }
        .logo-shinhan {
            width: 150px;
            margin: 0 0 20px;
            display: block;
        }
        .success-container {
            text-align: center;
            padding: 20px;
            background: #e6f0fa;
            border-radius: 10px;
        }
        .success-check {
            font-size: 50px;
            color: #28a745;
            margin-bottom: 20px;
        }
        .fireworks {
            background: url('https://example.com/fireworks.gif') center no-repeat;
            background-size: cover;
            height: 150px;
            margin-bottom: 20px;
        }
        .faq-container {
            margin-top: 20px;
            background: #f9fafb;
            padding: 16px;
            border-radius: 5px;
        }
        .faq-item {
            margin-bottom: 8px;
        }
        .faq-question {
            cursor: pointer;
            font-weight: 600;
            color: #004b8d;
        }
        .faq-answer {
            display: none;
            font-size: 14px;
            color: #333;
            margin-top: 8px;
        }
        .loan-info {
            background: #e6f0fa;
            padding: 16px;
            border-radius: 5px;
            margin-top: 8px;
            font-size: 14px;
        }
        .download-link {
            color: #f28c38;
            text-decoration: underline;
            cursor: pointer;
        }
        .download-link:hover {
            color: #d97a30;
        }
        .contact-section {
            text-align: center;
            margin-top: 20px;
        }
        .contact-section a {
            color: #f28c38;
            text-decoration: underline;
        }
        .contact-section a:hover {
            color: #d97a30;
        }
        .error-container {
            text-align: center;
            color: #EF4444;
            padding: 20px;
            background: #fff;
            border-radius: 10px;
            max-width: 800px;
            width: 100%;
        }
        @media (max-width: 767px) {
            .modal-content {
                padding: 10px;
            }
            .modal-title {
                font-size: 20px;
            }
            .progress-step {
                font-size: 12px;
                padding: 5px;
            }
            .photo-preview {
                height: auto;
            }
            .contract-table th, .contract-table td {
                font-size: 12px;
                padding: 6px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="section">
            <h2>Giới Thiệu</h2>
            <p>Với gói Vay tiêu dùng lãi suất ưu đãi tại Ngân hàng Shinhan, bạn có thể thực hiện mọi kế hoạch tài chính của mình và tận hưởng cuộc sống một cách trọn vẹn.</p>
            <button class="btn-primary" onclick="openRegistration()">Đăng ký ngay</button>
            <button class="btn-primary" onclick="openLoanCalculator()">Tính khoản vay</button>
        </div>
        <div class="section">
            <h2>Lợi ích</h2>
            <ul>
                <li>Lãi suất ưu đãi chỉ từ 11%/năm, tính trên dư nợ giảm dần</li>
                <li>Hạn mức cho vay lên đến 900 triệu đồng</li>
                <li>Thời hạn vay lên đến 60 tháng</li>
                <li>Thủ tục đơn giản, nhanh chóng</li>
                <li>Không yêu cầu tài sản thế chấp hay bảo lãnh của công ty</li>
            </ul>
        </div>
        <div class="section">
            <h2>Giấy Tờ Cần Thiết</h2>
            <ul>
                <li>CMND/Hộ chiếu còn hiệu lực</li>
                <li>Hồ sơ chứng minh địa chỉ thường trú/tạm trú</li>
                <li>Hồ sơ chứng minh thu nhập</li>
            </ul>
        </div>
    </div>

    <!-- Loan Calculator Modal -->
    <div id="loanCalculatorModal" style="display: none;">
        <div class="modal-overlay" onclick="closeLoanCalculator()"></div>
        <div class="modal-content">
            <div class="modal-title">Tính Khoản Vay Shinhan Bank</div>
            <form id="loanForm">
                <label for="loanType">Loại khoản vay:</label>
                <select id="loanType" onchange="updateInterestRate()">
                    <option value="tinchap">Vay tín chấp</option>
                    <option value="digital_tinchap">Vay tín chấp số</option>
                    <option value="thechap_nha">Vay thế chấp mua nhà</option>
                    <option value="thechap_xe">Vay thế chấp mua xe</option>
                    <option value="thechap_xe_cu">Vay thế chấp xe đã qua sử dụng</option>
                    <option value="tai_nha">Vay tái tài trợ nhà</option>
                    <option value="dam_bao">Vay đảm bảo bán lẻ (SGI)</option>
                </select>
                <label for="amount">Số tiền vay (VND):</label>
                <input type="number" id="amount" min="1000000" required>
                <label for="term">Thời hạn vay (tháng):</label>
                <input type="number" id="term" min="12" max="240" required>
                <label for="interest">Lãi suất (%/năm):</label>
                <input type="number" id="interest" step="0.1" value="12.5" readonly>
                <button type="button" onclick="calculateLoan()">Tính toán</button>
            </form>
            <div id="result"></div>
            <button class="btn-primary mt-4" onclick="closeLoanCalculator()">Đóng</button>
        </div>
    </div>

    <!-- Registration Modal -->
    <div id="registrationModal" style="display: none;">
        <div class="modal-overlay" onclick="closeRegistration()"></div>
        <div class="modal-content" id="registrationRoot"></div>
    </div>

    <script>
        // Initialize EmailJS
        emailjs.init("c-Ms5MjWbitpDBb-E");

        // Initialize FaceIO
        let faceio;
        try {
            faceio = new faceIO("YOUR_FACEIO_APP_ID");
        } catch (e) {
            console.error("FaceIO initialization failed:", e);
            faceio = { authenticate: () => Promise.resolve() };
        }

        // Loan Packages
        const loanPackages = [
            { value: "Vay Mua Xe", label: "Vay Mua Xe", description: "Lãi suất 7.1%/năm, hạn mức lên đến 2 tỷ đồng, thời hạn linh hoạt 12-84 tháng.", interestRate: 0.071 },
            { value: "Vay Mua Nhà", label: "Vay Mua Nhà", description: "Lãi suất 4.5%/năm, hạn mức lên đến 10 tỷ đồng, thời hạn linh hoạt 12-300 tháng.", interestRate: 0.045 },
            { value: "Vay Tiêu Dùng", label: "Vay Tiêu Dùng", description: "Lãi suất 5.5%/năm, hạn mức lên đến 600 triệu đồng, thời hạn linh hoạt 12-60 tháng.", interestRate: 0.055 },
            { value: "Vay Tiêu Dùng Trực Tuyến", label: "Vay Tiêu Dùng Trực Tuyến", description: "Lãi suất 5.5%/năm, hạn mức lên đến 600 triệu đồng, đăng ký 100% online, thời hạn 12-60 tháng.", interestRate: 0.055 },
            { value: "Vay Thế Chấp Sổ Tiết Kiệm", label: "Vay Thế Chấp Sổ Tiết Kiệm", description: "Lãi suất 1.9%/năm, hạn mức lên đến 90% giá trị sổ, thời hạn linh hoạt 12-120 tháng.", interestRate: 0.019 },
            { value: "Vay Tiêu Dùng Bảo Lãnh", label: "Vay Tiêu Dùng Bảo Lãnh", description: "Lãi suất 11.5%/năm, hạn mức lên đến 1 tỷ đồng, thời hạn linh hoạt 12-60 tháng.", interestRate: 0.115 },
            { value: "Vay Trả Nợ Thế Chấp", label: "Vay Trả Nợ Thế Chấp", description: "Lãi suất 4.5%/năm, hạn mức linh hoạt theo giá trị tài sản, thời hạn 12-240 tháng.", interestRate: 0.045 },
            { value: "Vay Mua Xe Đã Qua Sử Dụng", label: "Vay Mua Xe Đã Qua Sử Dụng", description: "Lãi suất 7.9%/năm, hạn mức lên đến 1.5 tỷ đồng, thời hạn linh hoạt 12-72 tháng.", interestRate: 0.079 },
            { value: "Vay Cho Nợ Xấu", label: "Vay Cho Nợ Xấu", description: "Lãi suất 8.9%/năm, hạn mức lên đến 500 triệu đồng, thời hạn linh hoạt 12-48 tháng.", interestRate: 0.089 },
            { value: "Vay Vốn Đầu Tư Kinh Doanh", label: "Vay Vốn Đầu Tư Kinh Doanh", description: "Lãi suất 5.9%/năm, hạn mức lên đến 5 tỷ đồng, thời hạn linh hoạt 12-120 tháng.", interestRate: 0.059 },
            { value: "Vay Bổ Sung Vốn Lưu Động", label: "Vay Bổ Sung Vốn Lưu Động", description: "Lãi suất 4.75%/năm, hạn mức lên đến 3 tỷ đồng, thời hạn linh hoạt 12-60 tháng.", interestRate: 0.0475 }
        ];

        // FAQ Data
        const faqData = [
            { question: "CCCD có cần công chứng không?", answer: "Không, bạn chỉ cần chụp ảnh CCCD rõ nét, không cần công chứng." },
            { question: "Thời gian duyệt hồ sơ bao lâu?", answer: "Hồ sơ được duyệt trong 24-48 giờ sau khi xác minh." },
            { question: "Tôi có thể trả nợ trước hạn không?", answer: "Có, nhưng sẽ áp dụng phí trả trước hạn từ 2-6% tùy kỳ." },
            { question: "Số dư tối thiểu là gì?", answer: "Số dư tối thiểu 10% khoản vay nhằm xác minh năng lực tài chính, không cần chuyển hay đóng phí." }
        ];

        // Loan Calculator Logic
        function updateInterestRate() {
            const loanType = document.getElementById('loanType').value;
            const interestInput = document.getElementById('interest');
            if (loanType === 'tinchap') {
                interestInput.value = 12.5;
            } else if (loanType === 'digital_tinchap') {
                interestInput.value = 7.4;
            } else if (loanType === 'thechap_nha') {
                interestInput.value = 7.5;
            } else if (loanType === 'thechap_xe') {
                interestInput.value = 7.8;
            } else if (loanType === 'thechap_xe_cu') {
                interestInput.value = 8.5;
            } else if (loanType === 'tai_nha') {
                interestInput.value = 7.5;
            } else if (loanType === 'dam_bao') {
                interestInput.value = 7.0;
            }
        }

        function getSuggestions(amount, term) {
            let suggestions = '<div class="suggestion"><h4>Đề xuất khoản vay:</h4><ul>';
            if (amount <= 100000000 && term <= 36) {
                suggestions += '<li><strong>Vay tín chấp số</strong>: Phù hợp với khoản vay nhỏ (tối đa 100 triệu VND). Lãi suất 7.4%/năm, phê duyệt nhanh trong 5 phút, miễn phí đăng ký.</li>';
            }
            if (amount <= 900000000 && term <= 60) {
                suggestions += '<li><strong>Vay tín chấp</strong>: Phù hợp với nhu cầu tiêu dùng cá nhân (tối đa 900 triệu VND). Lãi suất từ 12.5%/năm, không cần tài sản đảm bảo.</li>';
            }
            if (amount > 500000000 && term > 60) {
                suggestions += '<li><strong>Vay thế chấp mua nhà</strong>: Phù hợp với khoản vay lớn (tối đa 80% giá trị nhà). Lãi suất từ 7.5%/năm, kỳ hạn đến 20 năm. Miễn phí thẩm định cho khoản vay trên 2 tỷ VND.</li>';
                suggestions += '<li><strong>Vay tái tài trợ nhà</strong>: Phù hợp để tái cấu trúc khoản vay nhà (lãi suất từ 7.5%/năm). Kỳ hạn đến 20 năm.</li>';
            }
            if (amount <= 2000000000 && term <= 96) {
                suggestions += '<li><strong>Vay thế chấp mua xe</strong>: Phù hợp mua xe mới (tối đa 80% giá trị xe). Lãi suất từ 7.8%/năm, kỳ hạn đến 8 năm. Giảm 0.1% cho xe hybrid/điện, 0.3% cho xe THACO AUTO.</li>';
                suggestions += '<li><strong>Vay thế chấp xe đã qua sử dụng</strong>: Phù hợp mua xe cũ (lãi suất từ 8.5%/năm). Kỳ hạn đến 6 năm.</li>';
            }
            suggestions += '<li><strong>Vay đảm bảo bán lẻ (SGI)</strong>: Phù hợp với nhu cầu linh hoạt, có tài sản đảm bảo. Lãi suất từ 7.0%/năm, kỳ hạn tùy chỉnh.</li>';
            suggestions += '</ul></div>';
            return suggestions;
        }

        function calculateLoan() {
            const amount = Math.round(parseFloat(document.getElementById('amount').value));
            const term = parseInt(document.getElementById('term').value);
            const interestRate = parseFloat(document.getElementById('interest').value) / 100 / 12;
            let remainingBalance = amount;
            let monthlyPrincipal = Math.round(amount / term);
            let totalInterest = 0;
            let resultText = '<h3>Kết quả tính toán:</h3>';
            resultText += '<table><tr><th>Tháng</th><th>Gốc (VND)</th><th>Lãi (VND)</th><th>Tổng (VND)</th></tr>';
            for (let i = 1; i <= term; i++) {
                const interest = Math.round(remainingBalance * interestRate);
                totalInterest += interest;
                remainingBalance -= monthlyPrincipal;
                const totalPayment = monthlyPrincipal + interest;
                resultText += `<tr><td>${i}</td><td>${monthlyPrincipal.toLocaleString('vi-VN')}</td><td>${interest.toLocaleString('vi-VN')}</td><td>${totalPayment.toLocaleString('vi-VN')}</td></tr>`;
            }
            resultText += '</table>';
            resultText += `<p><strong>Số tiền vay:</strong> ${amount.toLocaleString('vi-VN')} VND</p>`;
            resultText += `<p><strong>Tổng lãi phải trả:</strong> ${totalInterest.toLocaleString('vi-VN')} VND</p>`;
            resultText += `<p><strong>Tổng gốc + lãi:</strong> ${(amount + totalInterest).toLocaleString('vi-VN')} VND</p>`;
            resultText += getSuggestions(amount, term);
            document.getElementById('result').innerHTML = resultText;
        }

        // Modal Controls
        function openLoanCalculator() {
            document.getElementById('loanCalculatorModal').style.display = 'block';
            document.getElementById('registrationModal').style.display = 'none';
        }

        function closeLoanCalculator() {
            document.getElementById('loanCalculatorModal').style.display = 'none';
        }

        function openRegistration() {
            document.getElementById('registrationModal').style.display = 'block';
            document.getElementById('loanCalculatorModal').style.display = 'none';
        }

        function closeRegistration() {
            document.getElementById('registrationModal').style.display = 'none';
        }

        // Registration App Component
        function RegistrationApp() {
            const [state, setState] = React.useState({
                step: 1,
                formData: {
                    fullName: '', dob: '', gender: '', phone: '', email: '', monthlyIncome: '',
                    permanentAddress: '', temporaryAddress: '', occupation: '', referralCode: '',
                    idNumber: '', idIssueDate: '', idIssuePlace: '',
                    idPhotoFront: null, idPhotoBack: null, atmPhoto: null,
                    loanAmount: '', loanTerm: '', loanType: '',
                    bankAccountNumber: '', bankAccountName: '', bankName: ''
                },
                errors: {},
                monthlyPayment: 0,
                selectedInterestRate: 0.055,
                contractId: Math.floor(100000 + Math.random() * 900000),
                showSuccess: false,
                showContract: false,
                error: null
            });

            const { step, formData, errors, monthlyPayment, selectedInterestRate, contractId, showSuccess, showContract, error } = state;

            React.useEffect(() => {
                localStorage.setItem('formData', JSON.stringify(formData));
            }, [formData]);

            React.useEffect(() => {
                try {
                    const savedData = JSON.parse(localStorage.getItem('formData')) || {};
                    setState(prev => ({ ...prev, formData: { ...prev.formData, ...savedData } }));
                } catch (e) {
                    console.error("Failed to load form data:", e);
                }
            }, []);

            const calculateMonthlyPayment = (amount, term, rate) => {
                const monthlyRate = rate / 12;
                return (amount * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -term));
            };

            const numberToWords = (num) => {
                const units = ['', 'nghìn', 'triệu', 'tỷ'];
                let result = '';
                let unitIndex = 0;
                while (num > 0) {
                    let part = num % 1000;
                    if (part > 0) {
                        result = `${part} ${units[unitIndex]} ${result}`;
                    }
                    num = Math.floor(num / 1000);
                    unitIndex++;
                }
                return result.trim() || 'không';
            };

            const validateStep = (step) => {
                const newErrors = {};
                if (step === 1) {
                    if (!formData.fullName) newErrors.fullName = "Vui lòng nhập họ và tên";
                    if (!formData.dob) newErrors.dob = "Vui lòng nhập ngày sinh";
                    if (!formData.gender) newErrors.gender = "Vui lòng chọn giới tính";
                    if (!/^(03|05|07|08|09|01[2|6|8|9])[0-9]{8}$/.test(formData.phone)) newErrors.phone = "Số điện thoại không hợp lệ";
                    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formData.email)) newErrors.email = "Email không hợp lệ";
                    if (!formData.monthlyIncome || formData.monthlyIncome <= 0) newErrors.monthlyIncome = "Thu nhập hàng tháng phải là số dương";
                    if (!formData.permanentAddress) newErrors.permanentAddress = "Vui lòng nhập địa chỉ thường trú";
                    if (!formData.temporaryAddress) newErrors.temporaryAddress = "Vui lòng nhập địa chỉ tạm trú";
                    if (!formData.occupation) newErrors.occupation = "Vui lòng nhập nghề nghiệp";
                } else if (step === 2) {
                    if (!/^[a-zA-Z0-9]+$/.test(formData.idNumber)) newErrors.idNumber = "Số CCCD/CMND không hợp lệ";
                    if (!formData.idIssueDate) newErrors.idIssueDate = "Vui lòng nhập ngày cấp";
                    if (!formData.idIssuePlace) newErrors.idIssuePlace = "Vui lòng nhập nơi cấp";
                } else if (step === 3) {
                    if (!formData.idPhotoFront) newErrors.idPhotoFront = "Vui lòng tải ảnh mặt trước CCCD";
                    if (!formData.idPhotoBack) newErrors.idPhotoBack = "Vui lòng tải ảnh mặt sau CCCD";
                    if (!formData.atmPhoto) newErrors.atmPhoto = "Vui lòng tải ảnh thẻ ATM";
                } else if (step === 5) {
                    if (!formData.loanAmount || formData.loanAmount < 30000000 || formData.loanAmount > 600000000) newErrors.loanAmount = "Số tiền vay từ 30 triệu đến 600 triệu VNĐ";
                    if (!formData.loanTerm || formData.loanTerm < 12 || formData.loanTerm > 60) newErrors.loanTerm = "Thời hạn vay từ 12 đến 60 tháng";
                    if (!formData.loanType) newErrors.loanType = "Vui lòng chọn loại vay";
                    if (!formData.bankAccountNumber) newErrors.bankAccountNumber = "Vui lòng nhập số tài khoản ngân hàng";
                    if (!formData.bankAccountName) newErrors.bankAccountName = "Vui lòng nhập họ và tên chủ tài khoản";
                    if (!formData.bankName) newErrors.bankName = "Vui lòng nhập tên ngân hàng";
                }
                setState(prev => ({ ...prev, errors: newErrors }));
                return Object.keys(newErrors).length === 0;
            };

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setState(prev => {
                    const newFormData = { ...prev.formData, [name]: value };
                    let newMonthlyPayment = prev.monthlyPayment;
                    let newInterestRate = prev.selectedInterestRate;
                    if (name === 'loanType') {
                        const selectedPackage = loanPackages.find(pkg => pkg.value === value);
                        newInterestRate = selectedPackage ? selectedPackage.interestRate : 0.055;
                    }
                    if (name === 'loanAmount' || name === 'loanTerm' || name === 'loanType') {
                        const amount = newFormData.loanAmount ? parseInt(newFormData.loanAmount) : 0;
                        const term = newFormData.loanTerm ? parseInt(newFormData.loanTerm) : 0;
                        if (amount && term) {
                            newMonthlyPayment = calculateMonthlyPayment(amount, term, newInterestRate);
                        }
                    }
                    return { ...prev, formData: newFormData, monthlyPayment: newMonthlyPayment, selectedInterestRate: newInterestRate };
                });
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (file && file.size > 5 * 1000000) {
                    alert("Ảnh không được vượt quá 5MB!");
                    return;
                }
                try {
                    new Compressor(file, {
                        quality: 0.6,
                        success(result) {
                            setState(prev => ({ ...prev, formData: { ...prev.formData, [e.target.name]: result } }));
                        },
                        error(err) {
                            console.error("Image compression failed:", err.message);
                            setState(prev => ({ ...prev, error: "Lỗi nén ảnh, vui lòng thử lại." }));
                        }
                    });
                } catch (e) {
                    console.error("Compressor.js failed:", e);
                    setState(prev => ({ ...prev, error: "Lỗi xử lý ảnh, vui lòng thử lại." }));
                }
            };

            const verifyFace = async () => {
                try {
                    await faceio.authenticate({ locale: "auto" });
                    alert("Xác minh khuôn mặt thành công!");
                    setState(prev => ({ ...prev, step: 5 }));
                } catch (error) {
                    console.error("Face verification failed:", error);
                    alert("Xác minh khuôn mặt thất bại. Vui lòng thử lại!");
                }
            };

            const nextStep = (next) => {
                if (validateStep(step)) {
                    if (step === 4) {
                        verifyFace();
                    } else {
                        setState(prev => ({ ...prev, step: next }));
                    }
                }
            };

            const prevStep = (prev) => setState(prev => ({ ...prev, step: prev }));

            const submitForm = () => {
                if (validateStep(5)) {
                    const fileToBase64 = (file) => new Promise((resolve, reject) => {
                        if (!file) reject(new Error("File không tồn tại"));
                        const reader = new FileReader();
                        reader.onload = () => resolve(reader.result);
                        reader.onerror = () => reject(new Error("Không thể đọc file"));
                        reader.readAsDataURL(file);
                    });

                    const promises = [];
                    if (formData.idPhotoFront) promises.push(fileToBase64(formData.idPhotoFront));
                    else promises.push(Promise.resolve(''));
                    if (formData.idPhotoBack) promises.push(fileToBase64(formData.idPhotoBack));
                    else promises.push(Promise.resolve(''));
                    if (formData.atmPhoto) promises.push(fileToBase64(formData.atmPhoto));
                    else promises.push(Promise.resolve(''));

                    Promise.all(promises).then(([idPhotoFront, idPhotoBack, atmPhoto]) => {
                        emailjs.send("service_ytsr91e", "template_3a7yorj", {
                            fullName: formData.fullName || '',
                            phone: formData.phone || '',
                            email: formData.email || '',
                            monthlyIncome: formData.monthlyIncome || '0',
                            idNumber: formData.idNumber || '',
                            loanAmount: formData.loanAmount || '0',
                            loanTerm: formData.loanTerm || '0',
                            loanType: formData.loanType || '',
                            bankAccountNumber: formData.bankAccountNumber || '',
                            bankAccountName: formData.bankAccountName || '',
                            bankName: formData.bankName || '',
                            idPhotoFront: idPhotoFront,
                            idPhotoBack: idPhotoBack,
                            atmPhoto: atmPhoto,
                            to_email: "duyenduyenduyen318@gmail.com"
                        }).then(() => {
                            emailjs.send("service_ytsr91e", "template_3a7yorj", {
                                fullName: formData.fullName || '',
                                email: formData.email || '',
                                contractId: contractId || '0',
                                loanAmount: formData.loanAmount || '0',
                                loanTerm: formData.loanTerm || '0',
                                loanType: formData.loanType || '',
                                to_email: formData.email || ''
                            });
                            setState(prev => ({ ...prev, showSuccess: true }));
                        }).catch((err) => {
                            console.error("EmailJS send failed:", err);
                            setState(prev => ({ ...prev, error: "Lỗi khi gửi hồ sơ, vui lòng thử lại." }));
                        });
                    }).catch((err) => {
                        console.error("File conversion failed:", err);
                        setState(prev => ({ ...prev, error: "Lỗi xử lý ảnh, vui lòng thử lại." }));
                    });
                }
            };

            const downloadContract = (containerId, filename) => {
                try {
                    const element = document.getElementById(containerId);
                    if (element) {
                        html2pdf().from(element).set({
                            margin: 1,
                            filename: filename,
                            html2canvas: { scale: 2 },
                            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
                        }).save();
                    } else {
                        throw new Error("Không tìm thấy phần tử để tải PDF");
                    }
                } catch (e) {
                    console.error("PDF download failed:", e);
                    setState(prev => ({ ...prev, error: "Lỗi tải PDF, vui lòng thử lại." }));
                }
            };

            const shareContract = () => {
                try {
                    emailjs.send("service_ytsr91e", "template_3a7yorj", {
                        fullName: formData.fullName || '',
                        email: formData.email || '',
                        contractId: contractId || '0',
                        loanAmount: formData.loanAmount || '0',
                        loanTerm: formData.loanTerm || '0',
                        loanType: formData.loanType || '',
                        to_email: formData.email || ''
                    }).then(() => alert("Hợp đồng đã được gửi qua email!"));
                } catch (e) {
                    console.error("Email sharing failed:", e);
                    setState(prev => ({ ...prev, error: "Lỗi gửi email, vui lòng thử lại." }));
                }
            };

            React.useEffect(() => {
                if (showContract && formData.loanAmount && formData.loanTerm) {
                    try {
                        const ctx = document.getElementById('paymentChart')?.getContext('2d');
                        if (ctx) {
                            new Chart(ctx, {
                                type: 'line',
                                data: {
                                    labels: Array.from({ length: parseInt(formData.loanTerm) || 0 }, (_, i) => `Kỳ ${i + 1}`),
                                    datasets: [{
                                        label: 'Dư nợ',
                                        data: Array.from({ length: parseInt(formData.loanTerm) || 0 }, (_, i) => (parseInt(formData.loanAmount) || 0) * (1 - (i + 1) / (parseInt(formData.loanTerm) || 1))),
                                        borderColor: '#004b8d',
                                        fill: false
                                    }]
                                },
                                options: { scales: { y: { beginAtZero: true } } }
                            });
                        }
                    } catch (e) {
                        console.error("Chart initialization failed:", e);
                    }
                }
            }, [showContract]);

            React.useEffect(() => {
                if (showContract) {
                    try {
                        const map = new google.maps.Map(document.getElementById('branchMap'), {
                            center: { lat: 10.7769, lng: 106.7009 },
                            zoom: 12
                        });
                        new google.maps.Marker({
                            position: { lat: 10.7769, lng: 106.7009 },
                            map: map,
                            title: "Chi nhánh ngân hàng"
                        });
                    } catch (e) {
                        console.error("Google Maps initialization failed:", e);
                    }
                }
            }, [showContract]);

            if (error) {
                return React.createElement('div', { className: 'error-container' },
                    React.createElement('h2', null, 'Lỗi hiển thị trang'),
                    React.createElement('p', null, error),
                    React.createElement('button', { className: 'btn-primary', onClick: () => window.location.reload() }, 'Tải lại trang')
                );
            }

            return React.createElement('div', null,
                !showSuccess && !showContract && React.createElement('div', null,
                    React.createElement('div', { className: 'modal-title' }, 'Đăng ký vay'),
                    React.createElement('div', { className: 'progress-bar' },
                        ['Thông tin cá nhân', 'Thông tin chứng minh', 'Chụp CCCD/CMND', 'Xác minh khuôn mặt', 'Thông tin vay'].map((label, i) =>
                            React.createElement('div', { key: i, className: `progress-step ${step === i + 1 ? 'active' : ''}` }, label)
                        )
                    ),
                    React.createElement('form', null,
                        step === 1 && React.createElement('div', { className: 'step active' },
                            React.createElement('p', { className: 'mb-4' }, React.createElement('strong', null, 'Hướng dẫn:'), ' Điền thông tin cá nhân chính xác. Các trường có (*) là bắt buộc.'),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('input', { name: 'fullName', placeholder: 'Họ và tên (*)', value: formData.fullName, onChange: handleInputChange, className: errors.fullName ? 'error' : '' }),
                                errors.fullName && React.createElement('div', { className: 'error-message' }, errors.fullName)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('input', { type: 'date', name: 'dob', value: formData.dob, onChange: handleInputChange, className: errors.dob ? 'error' : '' }),
                                errors.dob && React.createElement('div', { className: 'error-message' }, errors.dob)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('select', { name: 'gender', value: formData.gender, onChange: handleInputChange, className: errors.gender ? 'error' : '' },
                                    React.createElement('option', { value: '' }, 'Chọn giới tính (*)'),
                                    React.createElement('option', { value: 'Nam' }, 'Nam'),
                                    React.createElement('option', { value: 'Nữ' }, 'Nữ'),
                                    React.createElement('option', { value: 'Khác' }, 'Khác')
                                ),
                                errors.gender && React.createElement('div', { className: 'error-message' }, errors.gender)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('input', { name: 'phone', placeholder: 'Số điện thoại (*)', value: formData.phone, onChange: handleInputChange, className: errors.phone ? 'error' : '' }),
                                errors.phone && React.createElement('div', { className: 'error-message' }, errors.phone)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('input', { name: 'email', placeholder: 'Email (*)', value: formData.email, onChange: handleInputChange, className: errors.email ? 'error' : '' }),
                                errors.email && React.createElement('div', { className: 'error-message' }, errors.email)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('input', { type: 'number', name: 'monthlyIncome', placeholder: 'Thu nhập hàng tháng (VNĐ) (*)', value: formData.monthlyIncome, onChange: handleInputChange, className: errors.monthlyIncome ? 'error' : '' }),
                                errors.monthlyIncome && React.createElement('div', { className: 'error-message' }, errors.monthlyIncome)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('input', { name: 'permanentAddress', placeholder: 'Địa chỉ thường trú (*)', value: formData.permanentAddress, onChange: handleInputChange, className: errors.permanentAddress ? 'error' : '' }),
                                errors.permanentAddress && React.createElement('div', { className: 'error-message' }, errors.permanentAddress)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('input', { name: 'temporaryAddress', placeholder: 'Địa chỉ tạm trú (*)', value: formData.temporaryAddress, onChange: handleInputChange, className: errors.temporaryAddress ? 'error' : '' }),
                                errors.temporaryAddress && React.createElement('div', { className: 'error-message' }, errors.temporaryAddress)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('input', { name: 'occupation', placeholder: 'Nghề nghiệp (*)', value: formData.occupation, onChange: handleInputChange, className: errors.occupation ? 'error' : '' }),
                                errors.occupation && React.createElement('div', { className: 'error-message' }, errors.occupation)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('input', { name: 'referralCode', placeholder: 'Mã giới thiệu (nếu có)', value: formData.referralCode, onChange: handleInputChange })
                            ),
                            React.createElement('div', { className: 'faq-container' },
                                React.createElement('h3', { className: 'text-sm font-semibold mb-2' }, 'Câu hỏi thường gặp'),
                                faqData.map((faq, i) => React.createElement('div', { key: i, className: 'faq-item' },
                                    React.createElement('div', { className: 'faq-question', onClick: () => {
                                        const faqAnswer = document.getElementById(`faq-answer-${i}`);
                                        faqAnswer.style.display = faqAnswer.style.display === 'block' ? 'none' : 'block';
                                    }}, faq.question),
                                    React.createElement('div', { id: `faq-answer-${i}`, className: 'faq-answer' }, faq.answer)
                                ))
                            ),
                            React.createElement('div', { className: 'flex justify-end mt-4' },
                                React.createElement('button', { type: 'button', className: 'btn-primary', onClick: () => nextStep(2) }, 'Tiếp theo')
                            )
                        ),
                        step === 2 && React.createElement('div', { className: 'step active' },
                            React.createElement('p', { className: 'mb-4' }, React.createElement('strong', null, 'Hướng dẫn:'), ' Cung cấp thông tin giấy tờ tùy thân chính xác.'),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('input', { name: 'idNumber', placeholder: 'Số CCCD/CMND (*)', value: formData.idNumber, onChange: handleInputChange, className: errors.idNumber ? 'error' : '' }),
                                errors.idNumber && React.createElement('div', { className: 'error-message' }, errors.idNumber)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('input', { type: 'date', name: 'idIssueDate', value: formData.idIssueDate, onChange: handleInputChange, className: errors.idIssueDate ? 'error' : '' }),
                                errors.idIssueDate && React.createElement('div', { className: 'error-message' }, errors.idIssueDate)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('input', { name: 'idIssuePlace', placeholder: 'Nơi cấp (*)', value: formData.idIssuePlace, onChange: handleInputChange, className: errors.idIssuePlace ? 'error' : '' }),
                                errors.idIssuePlace && React.createElement('div', { className: 'error-message' }, errors.idIssuePlace)
                            ),
                            React.createElement('div', { className: 'faq-container' },
                                React.createElement('h3', { className: 'text-sm font-semibold mb-2' }, 'Câu hỏi thường gặp'),
                                faqData.map((faq, i) => React.createElement('div', { key: i, className: 'faq-item' },
                                    React.createElement('div', { className: 'faq-question', onClick: () => {
                                        const faqAnswer = document.getElementById(`faq-answer-${i}`);
                                        faqAnswer.style.display = faqAnswer.style.display === 'block' ? 'none' : 'block';
                                    }}, faq.question),
                                    React.createElement('div', { id: `faq-answer-${i}`, className: 'faq-answer' }, faq.answer)
                                ))
                            ),
                            React.createElement('div', { className: 'flex justify-between mt-4' },
                                React.createElement('button', { type: 'button', className: 'btn-primary bg-gray-400', onClick: () => prevStep(1) }, 'Quay lại'),
                                React.createElement('button', { type: 'button', className: 'btn-primary', onClick: () => nextStep(3) }, 'Tiếp theo')
                            )
                        ),
                        step === 3 && React.createElement('div', { className: 'step active' },
                            React.createElement('p', { className: 'mb-4' }, React.createElement('strong', null, 'Hướng dẫn:'), ' Chụp ảnh CCCD/CMND rõ nét (mặt trước và sau) và thẻ ATM.'),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('label', null, 'Ảnh CCCD/CMND (Mặt trước) (*)'),
                                React.createElement('input', { type: 'file', name: 'idPhotoFront', accept: 'image/jpeg,image/png', onChange: handleFileUpload, className: errors.idPhotoFront ? 'error' : '' }),
                                formData.idPhotoFront && React.createElement('img', { src: URL.createObjectURL(formData.idPhotoFront), className: 'photo-preview', alt: 'Mặt trước CCCD' }),
                                errors.idPhotoFront && React.createElement('div', { className: 'error-message' }, errors.idPhotoFront)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('label', null, 'Ảnh CCCD/CMND (Mặt sau) (*)'),
                                React.createElement('input', { type: 'file', name: 'idPhotoBack', accept: 'image/jpeg,image/png', onChange: handleFileUpload, className: errors.idPhotoBack ? 'error' : '' }),
                                formData.idPhotoBack && React.createElement('img', { src: URL.createObjectURL(formData.idPhotoBack), className: 'photo-preview', alt: 'Mặt sau CCCD' }),
                                errors.idPhotoBack && React.createElement('div', { className: 'error-message' }, errors.idPhotoBack)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('label', null, 'Ảnh thẻ ATM (*)'),
                                React.createElement('input', { type: 'file', name: 'atmPhoto', accept: 'image/jpeg,image/png', onChange: handleFileUpload, className: errors.atmPhoto ? 'error' : '' }),
                                formData.atmPhoto && React.createElement('img', { src: URL.createObjectURL(formData.atmPhoto), className: 'photo-preview', alt: 'Thẻ ATM' }),
                                errors.atmPhoto && React.createElement('div', { className: 'error-message' }, errors.atmPhoto)
                            ),
                            React.createElement('div', { className: 'faq-container' },
                                React.createElement('h3', { className: 'text-sm font-semibold mb-2' }, 'Câu hỏi thường gặp'),
                                faqData.map((faq, i) => React.createElement('div', { key: i, className: 'faq-item' },
                                    React.createElement('div', { className: 'faq-question', onClick: () => {
                                        const faqAnswer = document.getElementById(`faq-answer-${i}`);
                                        faqAnswer.style.display = faqAnswer.style.display === 'block' ? 'none' : 'block';
                                    }}, faq.question),
                                    React.createElement('div', { id: `faq-answer-${i}`, className: 'faq-answer' }, faq.answer)
                                ))
                            ),
                            React.createElement('div', { className: 'flex justify-between mt-4' },
                                React.createElement('button', { type: 'button', className: 'btn-primary bg-gray-400', onClick: () => prevStep(2) }, 'Quay lại'),
                                React.createElement('button', { type: 'button', className: 'btn-primary', onClick: () => nextStep(4) }, 'Tiếp theo')
                            )
                        ),
                        step === 4 && React.createElement('div', { className: 'step active' },
                            React.createElement('p', { className: 'mb-4' }, React.createElement('strong', null, 'Hướng dẫn:'), ' Đặt khuôn mặt vào khung để xác minh danh tính.'),
                            React.createElement('div', { className: 'face-scan-circle' }, 'Đặt khuôn mặt vào đây'),
                            React.createElement('div', { className: 'faq-container' },
                                React.createElement('h3', { className: 'text-sm font-semibold mb-2' }, 'Câu hỏi thường gặp'),
                                faqData.map((faq, i) => React.createElement('div', { key: i, className: 'faq-item' },
                                    React.createElement('div', { className: 'faq-question', onClick: () => {
                                        const faqAnswer = document.getElementById(`faq-answer-${i}`);
                                        faqAnswer.style.display = faqAnswer.style.display === 'block' ? 'none' : 'block';
                                    }}, faq.question),
                                    React.createElement('div', { id: `faq-answer-${i}`, className: 'faq-answer' }, faq.answer)
                                ))
                            ),
                            React.createElement('div', { className: 'flex justify-between mt-4' },
                                React.createElement('button', { type: 'button', className: 'btn-primary bg-gray-400', onClick: () => prevStep(3) }, 'Quay lại'),
                                React.createElement('button', { type: 'button', className: 'btn-primary', onClick: () => nextStep(5) }, 'Xác minh')
                            )
                        ),
                        step === 5 && React.createElement('div', { className: 'step active' },
                            React.createElement('p', { className: 'mb-4' }, React.createElement('strong', null, 'Hướng dẫn:'), ' Cung cấp thông tin khoản vay chính xác.'),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('input', { type: 'number', name: 'loanAmount', placeholder: 'Số tiền vay (VNĐ) (*)', value: formData.loanAmount, onChange: handleInputChange, className: errors.loanAmount ? 'error' : '' }),
                                errors.loanAmount && React.createElement('div', { className: 'error-message' }, errors.loanAmount)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('input', { type: 'number', name: 'loanTerm', placeholder: 'Thời hạn vay (tháng) (*)', value: formData.loanTerm, onChange: handleInputChange, className: errors.loanTerm ? 'error' : '' }),
                                errors.loanTerm && React.createElement('div', { className: 'error-message' }, errors.loanTerm)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('select', { name: 'loanType', value: formData.loanType, onChange: handleInputChange, className: errors.loanType ? 'error' : '' },
                                    React.createElement('option', { value: '' }, 'Chọn loại vay (*)'),
                                    loanPackages.map(pkg => React.createElement('option', { key: pkg.value, value: pkg.value }, pkg.label))
                                ),
                                errors.loanType && React.createElement('div', { className: 'error-message' }, errors.loanType)
                            ),
                            formData.loanType && React.createElement('div', { className: 'loan-info' },
                                React.createElement('p', null, React.createElement('strong', null, formData.loanType)),
                                React.createElement('p', null, loanPackages.find(pkg => pkg.value === formData.loanType)?.description)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('input', { name: 'bankAccountNumber', placeholder: 'Số tài khoản ngân hàng (*)', value: formData.bankAccountNumber, onChange: handleInputChange, className: errors.bankAccountNumber ? 'error' : '' }),
                                errors.bankAccountNumber && React.createElement('div', { className: 'error-message' }, errors.bankAccountNumber)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('input', { name: 'bankAccountName', placeholder: 'Họ và tên chủ tài khoản (*)', value: formData.bankAccountName, onChange: handleInputChange, className: errors.bankAccountName ? 'error' : '' }),
                                errors.bankAccountName && React.createElement('div', { className: 'error-message' }, errors.bankAccountName)
                            ),
                            React.createElement('div', { className: 'input-container' },
                                React.createElement('input', { name: 'bankName', placeholder: 'Tên ngân hàng (*)', value: formData.bankName, onChange: handleInputChange, className: errors.bankName ? 'error' : '' }),
                                errors.bankName && React.createElement('div', { className: 'error-message' }, errors.bankName)
                            ),
                            monthlyPayment > 0 && React.createElement('div', { className: 'mt-4 p-4 bg-gray-100 rounded-lg' },
                                React.createElement('p', null, React.createElement('strong', null, 'Số tiền trả hàng tháng:'), ' ', Math.round(monthlyPayment).toLocaleString(), ' VNĐ')
                            ),
                            React.createElement('div', { className: 'faq-container' },
                                React.createElement('h3', { className: 'text-sm font-semibold mb-2' }, 'Câu hỏi thường gặp'),
                                faqData.map((faq, i) => React.createElement('div', { key: i, className: 'faq-item' },
                                    React.createElement('div', { className: 'faq-question', onClick: () => {
                                        const faqAnswer = document.getElementById(`faq-answer-${i}`);
                                        faqAnswer.style.display = faqAnswer.style.display === 'block' ? 'none' : 'block';
                                    }}, faq.question),
                                    React.createElement('div', { id: `faq-answer-${i}`, className: 'faq-answer' }, faq.answer)
                                ))
                            ),
                            React.createElement('div', { className: 'flex justify-between mt-4' },
                                React.createElement('button', { type: 'button', className: 'btn-primary bg-gray-400', onClick: () => prevStep(4) }, 'Quay lại'),
                                React.createElement('button', { type: 'button', className: 'btn-primary', onClick: submitForm }, 'Hoàn tất')
                            )
                        )
                    )
                ),
                showSuccess && React.createElement('div', { className: 'max-w-2xl w-full' },
                    React.createElement('div', { className: 'modal-title' }, 'Chúc mừng!'),
                    React.createElement('div', { className: 'success-container' },
                        React.createElement('div', { className: 'fireworks' }),
                        React.createElement('div', { className: 'success-check' }, '✔'),
                        React.createElement('p', null, React.createElement('strong', null, `Chúc mừng ${formData.fullName || ''}!`)),
                        React.createElement('p', null, `Đã duyệt khoản vay ${(parseInt(formData.loanAmount) || 0).toLocaleString()} VNĐ (${formData.loanType || ''}).`),
                        React.createElement('button', { className: 'btn-primary', onClick: () => setState(prev => ({ ...prev, showSuccess: false, showContract: true })) }, 'Xem hồ sơ')
                    )
                ),
                showContract && React.createElement('div', { className: 'modal-content-lg' },
                    React.createElement('div', { className: 'modal-title' }, 'Hồ sơ và hợp đồng vay'),
                    React.createElement('div', { className: 'contract-container', id: 'contract-vay' },
                        React.createElement('img', { src: 'https://example.com/logo.png', className: 'logo-shinhan', alt: 'Bank Logo' }),
                        React.createElement('h4', { style: { textAlign: 'center' } }, 'HỢP ĐỒNG CHO VAY'),
                        React.createElement('p', null, React.createElement('strong', null, 'Số hợp đồng:'), ' BANK-2025-', contractId),
                        React.createElement('p', null, React.createElement('strong', null, 'Ngày:'), ' ', new Date().toISOString().split('T')[0]),
                        React.createElement('table', { className: 'contract-table' },
                            React.createElement('tr', null, React.createElement('th', null, 'Bên cho vay'), React.createElement('td', null, 'Ngân hàng Shinhan')),
                            React.createElement('tr', null, React.createElement('th', null, 'Địa chỉ'), React.createElement('td', null, 'TP. Hồ Chí Minh')),
                            React.createElement('tr', null, React.createElement('th', null, 'Mã số DN'), React.createElement('td', null, '0304946247')),
                            React.createElement('tr', null, React.createElement('th', null, 'Bên vay'), React.createElement('td', null, formData.fullName || '')),
                            React.createElement('tr', null, React.createElement('th', null, 'Số CCCD/CMND'), React.createElement('td', null, formData.idNumber || '')),
                            React.createElement('tr', null, React.createElement('th', null, 'Số điện thoại'), React.createElement('td', null, formData.phone || '')),
                            React.createElement('tr', null, React.createElement('th', null, 'Email'), React.createElement('td', null, formData.email || '')),
                            React.createElement('tr', null, React.createElement('th', null, 'Thu nhập hàng tháng'), React.createElement('td', null, `${(parseInt(formData.monthlyIncome) || 0).toLocaleString()} VNĐ`)),
                            React.createElement('tr', null, React.createElement('th', null, 'Số tài khoản ngân hàng'), React.createElement('td', null, formData.bankAccountNumber || '')),
                            React.createElement('tr', null, React.createElement('th', null, 'Họ và tên chủ tài khoản'), React.createElement('td', null, formData.bankAccountName || '')),
                            React.createElement('tr', null, React.createElement('th', null, 'Tên ngân hàng'), React.createElement('td', null, formData.bankName || '')),
                            React.createElement('tr', null, React.createElement('th', null, 'Gói vay'), React.createElement('td', null, formData.loanType || '')),
                            React.createElement('tr', null, React.createElement('th', null, 'Số tiền vay'), React.createElement('td', null, `${(parseInt(formData.loanAmount) || 0).toLocaleString()} VNĐ (${numberToWords(parseInt(formData.loanAmount) || 0)})`)),
                            React.createElement('tr', null, React.createElement('th', null, 'Thời hạn vay'), React.createElement('td', null, `${formData.loanTerm || '0'} tháng`)),
                            React.createElement('tr', null, React.createElement('th', null, 'Số tiền trả hàng tháng'), React.createElement('td', null, `${Math.round(monthlyPayment || 0).toLocaleString()} VNĐ`)),
                            React.createElement('tr', null, React.createElement('th', null, 'Lãi suất'), React.createElement('td', null, `${(selectedInterestRate * 100).toFixed(1)}%/năm`))
                        ),
                        React.createElement('h5', { className: 'mt-4 font-semibold' }, 'Điều khoản chính'),
                        React.createElement('ol', { className: 'list-decimal ml-6' },
                            React.createElement('li', null, `Loại hình vay: ${formData.loanType || ''}.`),
                            React.createElement('li', null, 'Phương thức: Trả góp không tài sản đảm bảo.'),
                            React.createElement('li', null, 'Phí trả trước hạn: 6% (12 kỳ đầu), 4% (kỳ 13-18), 3% (kỳ 19-24), 2% (kỳ 25+).')
                        ),
                        React.createElement('h5', { className: 'mt-4 font-semibold' }, 'Lịch thanh toán'),
                        React.createElement('canvas', { id: 'paymentChart', className: 'w-full h-64' }),
                        React.createElement('div', { className: 'red-stamp' }),
                        React.createElement('div', { className: 'contract-footer' }, 'Ngân hàng Shinhan - Hợp đồng cho vay')
                    ),
                    React.createElement('p', null, React.createElement('strong', null, 'Khuyến khích:'), ' Vui lòng tải hợp đồng về máy để lưu trữ và tham khảo.'),
                    React.createElement('a', { className: 'download-link', onClick: () => downloadContract('contract-vay', 'HopDongVay.pdf') }, 'Tải hợp đồng vay (PDF)'),
                    React.createElement('div', { className: 'disbursement-container', id: 'disbursement-confirmation' },
                        React.createElement('img', { src: 'https://example.com/logo.png', className: 'logo-shinhan', alt: 'Bank Logo' }),
                        React.createElement('h4', { style: { textAlign: 'center' } }, 'GIẤY XÁC NHẬN ĐIỀU KIỆN GIẢI NGÂN'),
                        React.createElement('p', null, React.createElement('strong', null, 'Số hợp đồng:'), ' BANK-2025-', contractId),
                        React.createElement('p', null, React.createElement('strong', null, 'Ngày:'), ' ', new Date().toISOString().split('T')[0]),
                        React.createElement('table', { className: 'contract-table' },
                            React.createElement('tr', null, React.createElement('th', null, 'Bên vay'), React.createElement('td', null, formData.fullName || '')),
                            React.createElement('tr', null, React.createElement('th', null, 'Số CCCD/CMND'), React.createElement('td', null, formData.idNumber || '')),
                            React.createElement('tr', null, React.createElement('th', null, 'Gói vay'), React.createElement('td', null, formData.loanType || '')),
                            React.createElement('tr', null, React.createElement('th', null, 'Số tiền vay'), React.createElement('td', null, `${(parseInt(formData.loanAmount) || 0).toLocaleString()} VNĐ`)),
                            React.createElement('tr', null, React.createElement('th', null, 'Thời hạn vay'), React.createElement('td', null, `${formData.loanTerm || '0'} tháng`)),
                            React.createElement('tr', null, React.createElement('th', null, 'Lãi suất'), React.createElement('td', null, `${(selectedInterestRate * 100).toFixed(1)}%/năm`)),
                            React.createElement('tr', null, React.createElement('th', null, 'Số tài khoản ngân hàng'), React.createElement('td', null, formData.bankAccountNumber || '')),
                            React.createElement('tr', null, React.createElement('th', null, 'Họ và tên chủ tài khoản'), React.createElement('td', null, formData.bankAccountName || '')),
                            React.createElement('tr', null, React.createElement('th', null, 'Tên ngân hàng'), React.createElement('td', null, formData.bankName || ''))
                        ),
                       React.createElement('tr', null, React.createElement('th', null, 'Tên ngân hàng'), React.createElement('td', null, formData.bankName || ''))),
                        React.createElement('h5', { className: 'mt-4 font-semibold' }, 'Điều kiện giải ngân'),
                        React.createElement('p', null, `Quý khách ${formData.fullName || ''} đã duyệt hồ sơ với số tiền ${(parseInt(formData.loanAmount) || 0).toLocaleString()} VNĐ và thời hạn ${formData.loanTerm || '0'} tháng, lãi suất ${(selectedInterestRate * 100).toFixed(1)}%/năm tại Ngân hàng Shinhan. Để được giải ngân số tiền, quý khách cần đáp ứng các điều kiện sau:`),
                        React.createElement('ul', { className: 'list-disc ml-6' },
                            React.createElement('li', null, 'Khoản vay không yêu cầu thế chấp hay thẩm định tài sản, tuy nhiên để hoàn tất quá trình giải ngân, ngân hàng yêu cầu Quý Khách duy trì số dư tối thiểu bằng 10% giá trị khoản vay trong tài khoản ngân hàng cá nhân.'),
                            React.createElement('li', null, 'Số dư này nhằm mục đích xác minh năng lực tài chính và khả năng hoàn trả khoản vay. Quý Khách chỉ cần duy trì số dư trong tài khoản, không cần nạp thêm, đóng phí, hay chuyển tiền cho bất kỳ cá nhân hay tổ chức nào.'),
                            React.createElement('li', null, 'Ví dụ minh họa: Nếu Quý Khách vay 30.000.000 VNĐ, thì số dư trong tài khoản cần đạt tối thiểu 3.000.000 VNĐ tại thời điểm ngân hàng xác minh.'),
                            React.createElement('li', null, 'Sau khi tài khoản đã có đủ số dư, Quý Khách vui lòng chụp ảnh màn hình tài khoản thể hiện rõ số dư hiện tại và gửi lại cho nhân viên phụ trách để hoàn tất thủ tục lên hồ sơ giải ngân.'),
                            React.createElement('li', null, 'Ngân hàng không thu bất kỳ khoản phí nào và không yêu cầu Quý Khách chuyển tiền cho bất kỳ cá nhân nào để được giải ngân.'),
                            React.createElement('li', null, 'Việc duy trì số dư trong tài khoản chỉ nhằm chứng minh khả năng tài chính. Ngay khi ngân hàng xác nhận điều kiện này đã được đáp ứng, hồ sơ sẽ được duyệt và giải ngân trong thời gian sớm nhất.'),
                            React.createElement('li', null, 'Ngay sau khi đảm bảo đủ số dư yêu cầu, Quý Khách vui lòng liên hệ lại với nhân viên phụ trách để đẩy nhanh quá trình xét duyệt và giải ngân.'),
                            React.createElement('li', null, 'Nếu có bất kỳ trường hợp nhân viên yêu cầu đóng phí hoặc chuyển tiền để được giải ngân, Quý Khách vui lòng liên hệ trực tiếp với ngân hàng để được xác minh và xử lý theo quy định.'),
                            React.createElement('li', null, 'Số dư tối thiểu chỉ cần được duy trì trong tài khoản của Quý Khách. Sau khi ngân hàng hoàn tất xét duyệt, toàn bộ khoản vay sẽ được chuyển thẳng về số tài khoản mà Quý Khách đã đăng ký.'),
                            React.createElement('li', null, 'Sau khi giải ngân, khách hàng không cần duy trì số dư nữa. Số tiền trong tài khoản có thể sử dụng tự do theo nhu cầu cá nhân – không bị ràng buộc.')
                        ),
                        React.createElement('div', { className: 'red-stamp' }),
                        React.createElement('div', { className: 'contract-footer' }, 'Ngân hàng Shinhan - Giấy xác nhận điều kiện giải ngân')
                    ),
                    React.createElement('p', null, React.createElement('strong', null, 'Khuyến khích:'), ' Vui lòng tải giấy xác nhận về máy để lưu trữ và tham khảo.'),
                    React.createElement('a', { className: 'download-link', onClick: () => downloadContract('disbursement-confirmation', 'GiayXacNhanGiaiNgan.pdf') }, 'Tải giấy xác nhận (PDF)'),
                    React.createElement('div', { className: 'contract-container', id: 'interest-fee-agreement' },
                        React.createElement('img', { src: 'https://example.com/logo.png', className: 'logo-shinhan', alt: 'Bank Logo' }),
                        React.createElement('h4', { style: { textAlign: 'center' } }, 'KHUNG LÃI SUẤT VÀ BIỂU PHÍ'),
                        React.createElement('p', null, React.createElement('strong', null, 'Số hợp đồng:'), ' BANK-2025-', contractId),
                        React.createElement('p', null, React.createElement('strong', null, 'Ngày:'), ' ', new Date().toISOString().split('T')[0]),
                        React.createElement('table', { className: 'contract-table' },
                            React.createElement('tr', null, React.createElement('th', null, 'Bên vay'), React.createElement('td', null, formData.fullName || '')),
                            React.createElement('tr', null, React.createElement('th', null, 'Gói vay'), React.createElement('td', null, formData.loanType || '')),
                            React.createElement('tr', null, React.createElement('th', null, 'Số tiền vay'), React.createElement('td', null, `${(parseInt(formData.loanAmount) || 0).toLocaleString()} VNĐ`)),
                            React.createElement('tr', null, React.createElement('th', null, 'Thời hạn vay'), React.createElement('td', null, `${formData.loanTerm || '0'} tháng`)),
                            React.createElement('tr', null, React.createElement('th', null, 'Lãi suất'), React.createElement('td', null, `${(selectedInterestRate * 100).toFixed(1)}%/năm`)),
                            React.createElement('tr', null, React.createElement('th', null, 'Phí trả trước hạn'), React.createElement('td', null, '6% (12 kỳ đầu), 4% (kỳ 13-18), 3% (kỳ 19-24), 2% (kỳ 25+)')),
                            React.createElement('tr', null, React.createElement('th', null, 'Số tài khoản ngân hàng'), React.createElement('td', null, formData.bankAccountNumber || '')),
                            React.createElement('tr', null, React.createElement('th', null, 'Họ và tên chủ tài khoản'), React.createElement('td', null, formData.bankAccountName || '')),
                            React.createElement('tr', null, React.createElement('th', null, 'Tên ngân hàng'), React.createElement('td', null, formData.bankName || ''))
                        ),
                        React.createElement('h5', { className: 'mt-4 font-semibold' }, 'Công thức tính lãi'),
                        React.createElement('p', null, 'Lãi = Dư nợ gốc x Lãi suất năm x Số ngày duy trì dư nợ / 365'),
                        React.createElement('div', { className: 'red-stamp' }),
                        React.createElement('div', { className: 'contract-footer' }, 'Ngân hàng Shinhan - Khung lãi suất và biểu phí')
                    ),
                    React.createElement('p', null, React.createElement('strong', null, 'Khuyến khích:'), ' Vui lòng tải khung lãi suất và biểu phí về máy để tham khảo.'),
                    React.createElement('a', { className: 'download-link', onClick: () => downloadContract('interest-fee-agreement', 'KhungLaiSuatVaBieuPhi.pdf') }, 'Tải khung lãi suất và biểu phí (PDF)'),
                    React.createElement('div', { className: 'mt-4' },
                        React.createElement('h5', { className: 'font-semibold' }, 'Tìm chi nhánh gần nhất'),
                        React.createElement('div', { id: 'branchMap', className: 'w-full h-64 rounded-lg' })
                    ),
                    React.createElement('div', { className: 'contact-section' },
                        React.createElement('h5', { className: 'font-semibold' }, 'Liên hệ nhân viên tư vấn'),
                        React.createElement('p', null, 'Nếu quý khách cần hỗ trợ hoặc đã đủ số dư để được xét duyệt nhanh hơn, vui lòng liên hệ nhân viên tư vấn qua:'),
                        React.createElement('div', { className: 'flex justify-center gap-4 mt-2' },
                            React.createElement('a', { href: 'https://m.me/shinhanfinancer?hash=AbbheNwiAth9Hcp7&source_id=8585216', target: '_blank', className: 'btn-primary' }, 'Messenger'),
                            React.createElement('a', { href: 'https://www.facebook.com/shinhanfinancer', target: '_blank', className: 'btn-primary' }, 'Facebook')
                        )
                    ),
                    React.createElement('button', { className: 'btn-primary mt-4', onClick: () => setState(prev => ({ ...prev, showContract: false })) }, 'Đóng')
                )
            );
        }

        // Render Registration App
        ReactDOM.render(
            React.createElement(RegistrationApp),
            document.getElementById('registrationRoot')
        );
    </script>
</body>
</html>
